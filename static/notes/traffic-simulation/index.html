<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building a Traffic Simulator with AI - Rob Righter's Apps & Curiosities</title>
    <link rel="stylesheet" href="../../styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Courier+Prime&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body>
    <header class="site-header">
        <div class="header-content">
            <h1 class="site-title"><a href="../../index.html" style="text-decoration: none; color: inherit;">ROB RIGHTER'S APPS & CURIOSITIES</a></h1>
            <span class="established">EST. 1978</span>
        </div>
        <nav class="main-nav">
            <a href="../../games.html">GAMES</a>
            <a href="../../mathematics.html">MATHEMATICS</a>
            <a href="../../retro.html">RETRO-COMPUTING</a>
            <a href="../../notes.html">NOTES & INQUIRIES</a>
        </nav>
    </header>

    <article>
        <header class="article-header">
            <h1 class="article-title">Building a Traffic Simulator with AI: From Idea to Interactive City in Minutes</h1>
            <div class="article-meta">
                <span>By Rob Righter</span>
                <span>Published: December 6, 2025</span>
                <span>Category: Notes & Inquiries</span>
            </div>
        </header>

        <div class="article-content">
            <div class="article-text">

            <p>I've always been fascinated by traffic simulations. There's something deeply satisfying about watching little cars navigate a grid of streets, stopping at intersections, waiting their turn, and flowing through a city like blood through veins. Maybe it's the emergent complexity—simple rules creating surprisingly realistic behavior—or maybe I just like watching tiny cars drive around. Either way, I've wanted to build one for years.</p>

            <p>The problem? Building a traffic simulator from scratch is <em>a lot</em> of work. You need to handle road networks, vehicle physics, intersection logic, collision detection, rendering... the list goes on. It's the kind of project that sits in your "someday" folder indefinitely.</p>

            <p>Enter AI-assisted development. What used to be a weekend-long project (at minimum) became an iterative conversation. I described what I wanted, refined it step by step, and ended up with a fully functional city traffic simulation—complete with buildings, stoplights, and cars that actually follow traffic laws.</p>

            <p>Here's how it works under the hood.</p>

            <h2>The Road Network</h2>

            <p>The simulation uses a simple grid-based street system. Roads are laid out at regular intervals (every 120 pixels), creating a Manhattan-style grid that covers the entire screen. Each road is 32 pixels wide, divided into two lanes—one for each direction of travel.</p>

            <p>The key insight here is separating the concept of "road position" from "lane position." Each car tracks which road it's on (<code>roadX</code>, <code>roadY</code>) and then applies a lane offset based on its direction of travel:</p>

            <ul>
                <li>Cars going <strong>right</strong> drive in the bottom lane</li>
                <li>Cars going <strong>left</strong> drive in the top lane</li>
                <li>Cars going <strong>down</strong> drive in the left lane</li>
                <li>Cars going <strong>up</strong> drive in the right lane</li>
            </ul>

            <p>This right-hand traffic system means cars naturally pass each other when traveling in opposite directions. No complex collision avoidance needed—just geometry.</p>

            <h2>Two Types of Intersections</h2>

            <p>The simulation features two types of intersections: <strong>4-way stop signs</strong> and <strong>traffic lights</strong>.</p>

            <h3>Stop Sign Logic</h3>

            <p>At stop sign intersections, cars follow proper 4-way stop etiquette:</p>

            <ol>
                <li>When a car approaches an intersection, it registers its arrival and joins a queue</li>
                <li>Each car receives an arrival timestamp and a random tiebreaker value</li>
                <li>Cars must come to a complete stop before proceeding</li>
                <li>The car that arrived first gets to go first</li>
                <li>If two cars arrive simultaneously, the random tiebreaker decides who goes</li>
            </ol>

            <p>This creates realistic stop-and-go behavior. You'll see cars politely taking turns, with occasional brief pauses as they "check" that the intersection is clear.</p>

            <h3>Traffic Light Logic</h3>

            <p>Seven intersections are randomly selected to become traffic lights instead of stop signs. These cycle through phases:</p>

            <ul>
                <li><strong>Green phase</strong> (3 seconds): North-south traffic flows freely</li>
                <li><strong>Yellow phase</strong> (0.75 seconds): Warning to stop</li>
                <li><strong>Red phase</strong>: Traffic stops while the perpendicular direction gets green</li>
            </ul>

            <p>The lights are staggered—they don't all change at the same time—which creates more natural traffic flow and prevents citywide synchronized gridlock.</p>

            <p>Cars approaching a green light don't need to stop at all (unless there's a car ahead of them). Red means stop. Yellow means stop if you're not already in the intersection.</p>

            <h2>Car Behavior</h2>

            <p>Each car is a simple state machine with the following states:</p>

            <ul>
                <li><strong>Driving</strong>: Moving forward at cruising speed</li>
                <li><strong>Approaching</strong>: Getting close to an intersection</li>
                <li><strong>Stopping</strong>: Coming to a complete stop</li>
                <li><strong>Waiting</strong>: Stopped and waiting for right-of-way</li>
                <li><strong>Crossing</strong>: Actively moving through an intersection</li>
            </ul>

            <p>Cars also have individual personality—each one gets a slightly randomized speed (80% to 120% of base speed), so faster cars will eventually catch up to slower ones.</p>

            <h3>Following Distance</h3>

            <p>Cars maintain safe following distance using a simple check: if there's another car ahead in the same lane within about 25 pixels, stop. This prevents rear-end collisions and creates natural traffic bunching behavior.</p>

            <h3>Turning</h3>

            <p>When cars clear an intersection, they have a 30% chance of turning onto the perpendicular road. When turning, they snap to the correct lane for their new direction. This keeps traffic circulating throughout the city rather than just driving in straight lines forever.</p>

            <h3>Edge Wrapping</h3>

            <p>Cars that drive off one edge of the screen wrap around to the opposite side, creating an infinite city illusion. When wrapping, they clear any intersection state to prevent ghost cars from blocking intersections they've left behind.</p>

            <h2>The Cityscape</h2>

            <p>What's a city without buildings? The simulation procedurally generates buildings to fill each city block. Each block gets one of four layout types:</p>

            <ol>
                <li><strong>Single large building</strong>: One structure fills most of the block</li>
                <li><strong>2x2 grid</strong>: Four smaller buildings arranged in a grid</li>
                <li><strong>Row of buildings</strong>: 2-3 buildings side by side</li>
                <li><strong>L-shaped arrangement</strong>: A large building with smaller ones tucked beside it</li>
            </ol>

            <p>Buildings have randomized features:</p>

            <ul>
                <li><strong>Colors</strong>: Browns, grays, tans, greens, reds, and blues</li>
                <li><strong>Roof colors</strong>: Dark browns, blues, grays, and reds</li>
                <li><strong>Roof details</strong>: Some buildings have AC units on top</li>
                <li><strong>Windows</strong>: Three different styles (square, wide, or tall)</li>
                <li><strong>Doors</strong>: Larger buildings get entrance doors</li>
            </ul>

            <h3>Living Windows</h3>

            <p>The windows have three states: dark (unlit), blue (reflective/daytime), and yellow (lit from inside). These states are pre-generated when buildings are created, but they slowly change over time—roughly one window per building might change every 25 seconds or so. This creates a subtle "lived-in" effect without the disco-ball flickering of purely random rendering.</p>

            <h2>Avoiding Gridlock</h2>

            <p>Traffic simulations are prone to deadlocks. A car waiting for an intersection that's waiting for another car that's waiting for the first car... classic gridlock.</p>

            <p>The simulation handles this with a few safety valves:</p>

            <ol>
                <li><strong>Timeout recovery</strong>: If a car waits more than 300 frames (~5 seconds), it forces the intersection clear and proceeds</li>
                <li><strong>Periodic cleanup</strong>: Every second, the simulation scrubs intersection queues to remove any stale references</li>
                <li><strong>Crossing car exception</strong>: Cars won't get stuck behind another car that's actively crossing an intersection</li>
            </ol>

            <p>These aren't perfect solutions, but they prevent the simulation from ever getting permanently stuck.</p>

            <h2>The Power of Iterative Development</h2>

            <p>What struck me most about building this wasn't the technical details—it was the process. I started with "make a traffic simulator with cars as squares on a grid." Then I refined:</p>

            <ul>
                <li>"Cars should stay in their lane and pass each other"</li>
                <li>"Make stop signs work properly—first to arrive goes first"</li>
                <li>"Add some traffic lights"</li>
                <li>"Add buildings to make it look like a city"</li>
                <li>"The window lights are changing too fast"</li>
            </ul>

            <p>Each iteration built on the last. Problems were identified and fixed in real-time. Features were added incrementally. The AI handled the boilerplate while I focused on what I actually wanted the simulation to <em>do</em>.</p>

            <p>This is the promise of AI-assisted development: not replacing programmers, but amplifying them. I have the domain knowledge (how traffic should flow, what makes a city feel alive) and the AI has the patience to write the rendering code, track down edge cases, and refactor when requirements change.</p>

            <h2>Try It Yourself</h2>

            <p>The full simulation runs in a single HTML file—no dependencies, no build step. Click anywhere on a road to add a car. Use the control panel to add multiple cars or clear the simulation. Resize your browser window to regenerate the city layout.</p>

            <p>Watch the cars negotiate intersections. Notice how traffic backs up at red lights, then flows freely when the light changes. See if you can spot the moment when a waiting car's brake lights go dark as it starts to move.</p>

            <p>It's not a perfect simulation of real traffic—there's no route planning, no pedestrians, no accidents, no road rage. But it captures something essential about the flow of vehicles through a city grid. And it took an afternoon to build instead of a month.</p>

            <p>That's the future of creative programming: more time thinking about what you want to build, less time fighting with the how.</p>

            <hr>

            <p><em>The traffic simulator is built with vanilla JavaScript and HTML5 Canvas. No frameworks were harmed in the making of this simulation.</em></p>
        </div>

            <aside class="article-illustration">
                <div class="illustration-container">
                    <img src="./ts.png" alt="City Traffic Simulation">
                    <p class="illustration-caption">Interactive city traffic simulation with buildings, stoplights, and intelligent vehicles</p>
                </div>

                <div class="illustration-container">
                    <p><a href="./app.html">Try the Simulator</a></p>
                </div>
            </aside>
        </div>

        <footer class="article-footer" style="text-align: center; padding: 2rem; border-top: 1px solid var(--border-color);">
            <nav style="font-family: 'Courier Prime', monospace; font-size: 0.9rem;">
                <a href="../../index.html" style="color: var(--accent-color); text-decoration: none;">← Return to Home</a>
                <span style="margin: 0 1rem;">|</span>
                <a href="../../games.html" style="color: inherit; text-decoration: none;">Games</a> |
                <a href="../../mathematics.html" style="color: inherit; text-decoration: none;">Mathematics</a> |
                <a href="../../retro.html" style="color: inherit; text-decoration: none;">Retro</a> |
                <a href="../../notes.html" style="color: inherit; text-decoration: none;">Notes</a>
            </nav>
        </footer>
    </article>

    <footer class="site-footer">
        <p>&copy; 2024 All Rights Reserved.</p>
    </footer>

    <script src="../../script.js"></script>
</body>
</html>
